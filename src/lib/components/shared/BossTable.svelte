<script lang="ts">
    import type { Entity } from "$lib/types";
    import { settings } from "$lib/utils/settings";
    import { tooltip } from "$lib/utils/tooltip";
    import { flip } from "svelte/animate";
    import BossRow from "./BossRow.svelte";

    export let bosses: Array<Entity>;
    export let tween = true;
    export let duration: number;
    export let inspectBoss: (boss: string) => void;

    let bossDamageDealtPercentages: Array<number> = [];

    $: {
        if (bosses.length > 0) {
            bossDamageDealtPercentages = bosses.map(
                (boss) => (boss.damageStats.damageDealt / bosses[0].damageStats.damageDealt!) * 100
            );
        }
    }
</script>

<table class="relative w-full table-fixed">
    <thead class="sticky top-0 z-40 h-6">
        <tr class="bg-zinc-900 tracking-tight">
            <th class="w-14 px-2 text-left font-normal" />
            <th class="w-full" />
            <th class="w-16 font-normal" use:tooltip={{ content: "입힌 피해량" }}>DMG</th>
            <th class="w-16 font-normal" use:tooltip={{ content: "초당 피해량" }}>DPS</th>
        </tr>
    </thead>
    <tbody class="relative z-10">
        {#each bosses as boss, i (boss.name)}
            <tr
                class="h-7 px-2 py-1 {$settings.general.underlineHovered ? 'hover:underline' : ''}"
                animate:flip={{ duration: 200 }}
                on:click={() => inspectBoss(boss.name)}>
                <BossRow {duration} {boss} width={bossDamageDealtPercentages[i]} {tween} index={i} />
            </tr>
        {/each}
    </tbody>
</table>
